<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css"
        integrity="sha512-8bHTC73gkZ7rZ7vpqUQThUDhqcNFyYi2xgDgPDHc+GXVGHXq+xPjynxIopALmOPqzo9JZj0k6OqqewdGO3EsrQ=="
        crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"
        integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg=="
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"
        integrity="sha512-dqw6X88iGgZlTsONxZK9ePmJEFrmHwpuMrsUChjAw1mRUhUITE5QU9pkcSox+ynfLhL15Sv2al5A0LVyDCmtUw=="
        crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>

    <style>
        body {
            background-color: #23272A;
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-flex-direction: row;
            -ms-flex-direction: row;
            flex-direction: row;
        }

        .menu.wrapper {
            position: fixed;
            z-index: 1;
            width: 250px;
            -webkit-box-flex: 0;
            -webkit-flex: 0 0 auto;
            -ms-flex: 0 0 auto;
            flex: 0 0 auto;
        }

        .ui.inverted.vertical.menu {
            background-color: #2C2F33;
            border-radius: 0;
            border-width: 0 1px 0 0;
            box-shadow: none;
            margin: 0;
            width: inherit;
            overflow: hidden;
            min-height: 100vh;
            max-height: 100vh;
            will-change: transform;
            overflow: auto;
            -webkit-overflow-scrolling: touch;
        }

        .body.content {
            -webkit-box-flex: 1;
            -webkit-flex: 1 1 auto;
            -ms-flex: 1 1 auto;
            flex: 1 1 auto;
            min-width: 0px;
            margin-top: 20px;
            margin-left: 270px !important;
        }

        p.value {
            text-align: right;
            font-weight: bold;
            font-size: 32px;
            margin-top: 30px !important;
        }

        .body.content>.grid {
            width: 133%;
        }

        .ui.chart.card {
            width: 98%;
        }

        div.chart canvas.chart {
            width: 95%;
            height: 200px;
        }

        p.version {
            position: absolute;
            right: 0;
            bottom: 0;
            color: #bababa;
        }
    </style>
</head>

<body>
    <div class="menu wrapper">
        <div class="ui inverted vertical menu">
            <div class="item">
                <a class="ui logo icon image" href="/">
                    <img src="/static/logo.png">
                </a>
            </div>
            <a class="active item">
                <i class="tachometer alternate icon"></i> Dashboard
            </a>
        </div>
    </div>

    <div class="body content">
        <div class="ui stackable grid">
            <div class="two wided column">
                <div class="ui card">
                    <div class="content">
                        <div class="header">Cores</div>
                        <p id="cores" class="value">

                        </p>
                    </div>
                </div>
            </div>
            <div class="two wided column">
                <div class="ui card">
                    <div class="content">
                        <div class="header">Threads</div>
                        <p id="threads" class="value">

                        </p>
                    </div>
                </div>
            </div>
            <div class="two wided column">
                <div class="ui card">
                    <div class="content">
                        <div class="header">Load</div>
                        <p id="avg_load" class="value">

                        </p>
                    </div>
                </div>
            </div>
            <div class="two wided column">
                <div class="ui card">
                    <div class="content">
                        <div class="header">Memory</div>
                        <p id="avg_memory" class="value">

                        </p>
                    </div>
                </div>
            </div>
            <div class="two wided column">
                <div class="ui card">
                    <div class="content">
                        <div class="header">Connections</div>
                        <p id="connections" class="value">

                        </p>
                    </div>
                </div>
            </div>
            <div class="two wided column">
                <div class="ui card">
                    <div class="content">
                        <div class="header">Players</div>
                        <p id="players" class="value">

                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="ui chart card">
            <div class="content">
                <div class="chart">
                    <canvas class="chart" id="load"></canvas>
                </div>
            </div>
        </div>

        <div class="ui chart card">
            <div class="content">
                <div class="chart">
                    <canvas class="chart" id="network"></canvas>
                </div>
            </div>
        </div>

        <div class="ui chart card">
            <div class="content">
                <div class="chart">
                    <canvas class="chart" id="server"></canvas>
                </div>
            </div>
        </div>
    </div>


    <script>
        var loadChart = new Chart(document.querySelector('#load').getContext('2d'),
            {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Process Load',
                        backgroundColor: "rgb(255, 99, 132)",
                        borderColor: "rgb(255, 99, 132)",
                        data: [
                        ],
                        fill: false
                    }, {
                        label: 'Total Load',
                        backgroundColor: "rgb(54, 162, 235)",
                        borderColor: "rgb(54, 162, 235)",
                        data: [
                        ],
                        fill: false
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    title: {
                        display: true,
                        position: 'top',
                        padding: 0,
                        text: 'Cpu Load'
                    },
                    tooltips: {
                        mode: 'index',
                        intersect: false
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true
                    },
                    scales: {
                        xAxes: [{
                            display: true,
                            scaleLabel: {
                                display: false,
                                labelString: 'Time'
                            }
                        }],
                        yAxes: [{
                            display: true,
                            scaleLabel: {
                                display: false,
                                labelString: 'Value'
                            }
                        }]
                    }
                }
            }
        )

        var networkChart = new Chart(document.querySelector('#network').getContext('2d'),
            {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Inbound',
                        backgroundColor: "rgb(255, 159, 64)",
                        borderColor: "rgb(255, 159, 64)",
                        data: [
                        ],
                        fill: false
                    }, {
                        label: 'Outbound',
                        backgroundColor: "rgb(75, 192, 192)",
                        borderColor: "rgb(75, 192, 192)",
                        data: [
                        ],
                        fill: false
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    title: {
                        display: true,
                        position: 'top',
                        padding: 0,
                        text: 'Network'
                    },
                    tooltips: {
                        mode: 'index',
                        intersect: false
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true
                    },
                    scales: {
                        xAxes: [{
                            display: true,
                            scaleLabel: {
                                display: false,
                                labelString: 'Time'
                            }
                        }],
                        yAxes: [{
                            display: true,
                            scaleLabel: {
                                display: false,
                                labelString: 'Value'
                            }
                        }]
                    }
                }
            }
        )

        var serverChart = new Chart(document.querySelector('#server').getContext('2d'),
            {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Connections',
                        backgroundColor: "rgb(201, 203, 207)",
                        borderColor: "rgb(201, 203, 207)",
                        data: [
                        ],
                        fill: false
                    }, {
                        label: 'Players',
                        backgroundColor: "rgb(153, 102, 255)",
                        borderColor: "rgb(153, 102, 255)",
                        data: [
                        ],
                        fill: false
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    title: {
                        display: true,
                        position: 'top',
                        padding: 0,
                        text: 'Server'
                    },
                    tooltips: {
                        mode: 'index',
                        intersect: false
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true
                    },
                    scales: {
                        xAxes: [{
                            display: true,
                            scaleLabel: {
                                display: false,
                                labelString: 'Time'
                            }
                        }],
                        yAxes: [{
                            display: true,
                            scaleLabel: {
                                display: false,
                                labelString: 'Value'
                            }
                        }]
                    }
                }
            }
        )

        function setStatus(Data) {
            $('#cores').text(Data.Cores)
            $('#threads').text(Data.Threads)
            $('#avg_load').text(`${Math.round(Data.TotalLoad)}%`)
            $('#avg_memory').text(`${Math.round(Data.UsedMemory / Data.TotalMemory * 100)}%`)
            $('#connections').text(Data.Connections)
            $('#players').text(Data.Players)

            loadChart.config.data.labels.push(new Date().toLocaleTimeString())
            loadChart.config.data.datasets.find((obj) => obj.label === 'Total Load').data.push(Data.TotalLoad)
            loadChart.config.data.datasets.find((obj) => obj.label === 'Process Load').data.push(Data.ProcessLoad)

            if (loadChart.config.data.labels.length > 10) {
                loadChart.config.data.labels.shift()

                loadChart.config.data.datasets.forEach((obj) => obj.data.shift())
            }

            loadChart.update()

            networkChart.config.data.labels.push(new Date().toLocaleTimeString())
            networkChart.config.data.datasets.find((obj) => obj.label === 'Inbound').data.push(Data.NetworkInbound)
            networkChart.config.data.datasets.find((obj) => obj.label === 'Outbound').data.push(Data.NetworkOutbound)

            if (networkChart.config.data.labels.length > 10) {
                networkChart.config.data.labels.shift()

                networkChart.config.data.datasets.forEach((obj) => obj.data.shift())
            }

            networkChart.update()

            serverChart.config.data.labels.push(new Date().toLocaleTimeString())
            serverChart.config.data.datasets.find((obj) => obj.label === 'Connections').data.push(Data.Connections)
            serverChart.config.data.datasets.find((obj) => obj.label === 'Players').data.push(Data.Players)

            if (serverChart.config.data.labels.length > 10) {
                serverChart.config.data.labels.shift()

                serverChart.config.data.datasets.forEach((obj) => obj.data.shift())
            }

            serverChart.update()
        }

        $.ajax({ url: '/version', method: 'get' }).done(x => $("p.version").html(`MIT License Discodo ${x}`))

        $.ajax({ url: '/status', method: 'get', dataType: 'json' }).done(setStatus)
        setInterval(() => {
            $.ajax({ url: '/status', method: 'get', dataType: 'json' }).done(setStatus)
        }, 1000)
    </script>
</body>

<p class="version"></p>

</html>
